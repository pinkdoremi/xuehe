title: css性能优化
date: 2014-09-23 21:28:26
categories: 
- css
tags: 
- css
- 性能
- 优化
---
最近查阅了很多资料，总结一下css性能和优化方面的一点知识。
<!-- more -->
##使用单一的css文件
虽然css提供了下面的方法来引入样式：

@import url(/css/aaa.css);

但是并不推荐这种做法：
1. 导入样式表比连接样式表慢
2. 多个样式文件--->服务器会发送更多数据包--->下载慢
3. 并行下载数量有限，老式浏览器不能同时下载多余2个文
4. 单一css容易维护

##缩小字节
1. 颜色缩写成3位或字数更少的字母形式：
eg. #ff0000 > #f00 > red
2. 0.1,0.2这种数字直接变成.1,.2
3. 长的类名缩写成短小的，这要和html和js一起改麻烦了点.
4. 减少多余的空格,不要换行。
5. 减少多余的分号
6. 删除注释
7. 删除多余不用的css


缩减字节的这种压缩方式可以交给一些压缩工具来执行。
在这里推荐：[CSS Shrink](http://cssshrink.com/)
CSS Shrink 是由来自 Facebook 的工程师 Stoyan Stefanov 开发的一个 CSS 压缩工具，与像 yuicompressor 之类的基于正则匹配的 css 压缩工具不同在于该工具是通过 AST（抽象语法树）对 css 做代码分析进行更智能的压缩，同时提供了基于 grunt 和 gulp 的插件。

关于第七点的补充：在 Chrome 开发者工具中，打开审计（Audits）面板，然后运行一次网页性能（Web Page Performance）报告。在生成的报告中，找一下“删除未使用的 CSS 规则（Remove unused CSS rules）”。也可以使用其它第三方工具或脚本，来识别每个页面分别应用了哪些 CSS 选择符。

##优化css选择器
首先有个前提：浏览器处理选择器的顺序是从右向左的，只要当前选择符的左边还有其他选择符，样式系统就会继续向左移动，直到找到和规则匹配的元素，或者因为不匹配而退出。

**css选择器性能排行（从最快的开始）**：
+  ID选择器：#id
+  class选择器： .class
+  标签: div
+  相邻的兄弟元素：a + i
+  子代选择器： ul > li
+  后代选择器：div div
+  通配符选择器： * 
+  属性选择器:a[rel="external"]
+ 伪类和伪元素： a:hover 

由上表总结出：
1. 避免使用通配符
2. 避免使用子代选择器，此外，子代选择器和html结构之间太过耦合不利于维护。
3. 多用class和id选择器，他们效率最高
4. id选择器之前就不需要加class或者标签了。id是页面唯一的，已经可以找到，再加class和标签它在之前就是多余的，反而会消耗浏览器资源，浏览器会继续查找样式。此外，img#a 并不会匹配 div#a。
5. 也不要在使用class时使用标签
6. 将多层的标签选择用class替换,减少css层数以减少查找
4. ps:css3选择器性能很差的,它会消耗很多资源，如果对性能敏感就不要使用了。

总的来说多用class选择器,id性能最好,但是由于唯一性用起来要小心。通配符，子代是别用了。其实后代经常能用到，写起来比较方便我还是很难割舍，其他的会因为具体条件和特殊情况下使用的。css3选择器的话，如果我不做移动web的，就不太怕性能什么的问题了，也可以考虑。


##减少css表达式

css表达式的计算频率是个需要被考虑的问题。随着页面的显示，缩放，鼠标位置，布局的调整，css动画等事件的发生而计算超级多次css表达式。一来要避免使用css表达式，二来要尽量使用一次性的表达式，或者使用事件句柄来代替css表达式。

##未完待续

以后看到还有什么优化方式还是会来补充的。我相信优化这条道路是没有尽头的。